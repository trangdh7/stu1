@{
    ViewData["Title"] = "X√°c nh·∫≠n xu·∫•t kho";
    Layout = "~/Areas/TruongBPKho/Views/Layout/Layout.cshtml";
}

@model Webkho_20241021.Areas.TruongBPKho.Data.Phieuxuatkhoviewmodel

<div class="container">
    <div class="alert alert-info my-3">
        <i class="bx bx-bell"></i>
        Danh s√°ch phi·∫øu xu·∫•t kho ƒëang ch·ªù x√°c nh·∫≠n ho·∫∑c ƒëang chu·∫©n b·ªã h√†ng.
    </div>

    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>STT</th>
                <th>M√£ xu·∫•t kho</th>
                <th>M√£ y√™u c·∫ßu</th>
                <th>M√£ d·ª± √°n</th>
                <th>Ng√†y xu·∫•t kho</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Thao t√°c</th>
            </tr>
        </thead>
        <tbody>
            @if (Model?.Phieuxuatkho != null && Model.Phieuxuatkho.Any())
            {
                int stt = 1;
                foreach (var item in Model.Phieuxuatkho)
                {
                    <tr>
                        <td>@(stt++)</td>
                        <td>
                            <a href="javascript:void(0)" onclick="showVTxuatkho('@item.MaXuatkho')" style="color:#1976d2;">
                                @item.MaXuatkho
                            </a>
                        </td>
                        <td>@item.MaYeucau</td>
                        <td>@item.MaDuan</td>
                        <td>@item.NgayXuatkho?.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>@item.TrangThai</td>
                        <td>
                            @if (item.TrangThai == "Ch·ªù x√°c nh·∫≠n")
                            {
                                <form asp-action="Xuliphieuxuatkho" method="post" style="display:inline-block;">
                                    <input type="hidden" name="MaXuatkho" value="@item.MaXuatkho" />
                                    <button type="submit" class="btn btn-success btn-sm">X√°c nh·∫≠n chu·∫©n b·ªã h√†ng</button>
                                </form>
                            }
                            else if (item.TrangThai == "ƒêang chu·∫©n b·ªã h√†ng")
                            {
                                <form asp-action="Xuliphieuxuatkho" method="post" style="display:inline-block;">
                                    <input type="hidden" name="MaXuatkho" value="@item.MaXuatkho" />
                                    <button type="submit" class="btn btn-warning btn-sm">Chuy·ªÉn sang ch·ªù ng∆∞·ªùi y√™u c·∫ßu x√°c nh·∫≠n</button>
                                </form>
                            }
                            else if (item.TrangThai == "Ch·ªù ng∆∞·ªùi y√™u c·∫ßu x√°c nh·∫≠n")
                            {
                                <button class="btn btn-secondary btn-sm" disabled>ƒêang ch·ªù ng∆∞·ªùi y√™u c·∫ßu</button>
                            }
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="7" class="text-center text-muted">Kh√¥ng c√≥ phi·∫øu xu·∫•t kho n√†o.</td>
                </tr>
            }
        </tbody>
    </table>

    <!-- B·∫£ng chi ti·∫øt v·∫≠t t∆∞ -->
    <div class="mt-4">
        <h4>üìã Chi ti·∫øt v·∫≠t t∆∞</h4>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>T√™n v·∫≠t t∆∞</th>
                    <th>M√£ v·∫≠t t∆∞</th>
                    <th>M√£ kho</th>
                    <th>H√£ng SX</th>
                    <th>Nh√† CC</th>
                    <th>S·ªë l∆∞·ª£ng</th>
                    <th>ƒê∆°n v·ªã</th>
                    <th>Tr·∫°ng th√°i</th>
                </tr>
            </thead>
            <tbody id="materialDetails">
                <tr>
                    <td colspan="9" class="text-center text-muted">
                        Ch·ªçn m·ªôt phi·∫øu xu·∫•t kho ƒë·ªÉ xem chi ti·∫øt v·∫≠t t∆∞.
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function showVTxuatkho(MaXuatkho) {
            $.ajax({
                url: '@Url.Action("GetVTPhieuxuatkho", "Yeucau", new { area = "TruongBPKho" })',
                method: 'GET',
                data: { MaXuatkho },
                success: function (data) {
                    $('#materialDetails').empty();
                    if (data && data.length > 0) {
                        let stt = 1;
                        data.forEach(item => {
                            $('#materialDetails').append(`
                                <tr>
                                    <td>${stt++}</td>
                                    <td>${item.tenSanpham || '-'}</td>
                                    <td>${item.maSanpham || '-'}</td>
                                    <td>${item.makho || '-'}</td>
                                    <td>${item.hangSX || '-'}</td>
                                    <td>${item.nhaCC || '-'}</td>
                                    <td>${item.sl || 0}</td>
                                    <td>${item.donVi || '-'}</td>
                                    <td>${item.trangThai || '-'}</td>
                                </tr>
                            `);
                        });
                    } else {
                        $('#materialDetails').append(`<tr><td colspan="9" class="text-center text-muted">Kh√¥ng c√≥ d·ªØ li·ªáu v·∫≠t t∆∞.</td></tr>`);
                    }
                },
                error: function (xhr, status, error) {
                    alert("Kh√¥ng th·ªÉ l·∫•y d·ªØ li·ªáu v·∫≠t t∆∞: " + error);
                }
            });
        }
    </script>
}
